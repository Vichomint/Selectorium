{% extends "layout_reclutador.html" %}
{% block title %}Administrar Vacante{% endblock %}
{% block main_content %}
<h2 class="text-2xl font-bold text-primary-700 mb-6">
  <i class="fas fa-briefcase mr-2"></i> {{ vacante.titulo }}
</h2>

<p class="text-gray-600 mb-6 whitespace-pre-line">{{ vacante.descripcion }}</p>

<h3 class="text-xl font-semibold text-gray-800 mb-4">Postulantes</h3>

{% if postulaciones %}
<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
  {% for postulacion in postulaciones %}
  {% with perfil=postulacion.postulante.profile %}
  <div class="bg-white rounded-2xl shadow overflow-hidden group">
    <div
      class="h-20 w-full {% if perfil and perfil.portada %}bg-cover bg-center{% else %}bg-gradient-to-r from-primary-500 to-primary-700{% endif %}"
      {% if perfil and perfil.portada %}style="background-image: url('{{ perfil.portada.url }}');"{% endif %}
    ></div>
    <div class="p-5 pt-0">
      <div class="-mt-10 mb-3">
        {% if perfil and perfil.foto %}
        <img src="{{ perfil.foto.url }}" alt="avatar" class="w-16 h-16 rounded-full ring-4 ring-white object-cover" />
        {% else %}
        <div class="w-16 h-16 rounded-full ring-4 ring-white bg-primary-100 flex items-center justify-center text-primary-700 font-bold">
          {{ postulacion.postulante.username|slice:":1"|upper }}
        </div>
        {% endif %}
      </div>
      <h4 class="text-lg font-semibold text-gray-900">{{ postulacion.postulante.username }}</h4>
      <p class="text-sm text-gray-500">{{ perfil.area_profesional|default:"-" }}</p>
      <div class="mt-2 flex flex-wrap items-center gap-2">
        <span class="px-2 py-0.5 rounded-full text-xs font-semibold {% if postulacion.estado == 'enviado' %}bg-yellow-100 text-yellow-700{% elif postulacion.estado == 'visto' %}bg-blue-100 text-blue-700{% elif postulacion.estado == 'aceptado' %}bg-green-100 text-green-700{% elif postulacion.estado == 'rechazado' %}bg-red-100 text-red-700{% else %}bg-gray-100 text-gray-700{% endif %}">
          {{ postulacion.get_estado_display }}
        </span>
        <span class="px-2 py-0.5 rounded-full text-xs font-semibold bg-slate-100 text-slate-700">
          {{ postulacion.etapa_display }}
        </span>
        {% if postulacion.match_label %}
        <span class="px-2 py-0.5 rounded-full text-xs font-semibold {% if postulacion.match_label == 'Muy apto' %}bg-green-100 text-green-700{% elif postulacion.match_label == 'Apto' %}bg-emerald-100 text-emerald-700{% elif postulacion.match_label == 'Poco apto' %}bg-yellow-100 text-yellow-700{% else %}bg-gray-100 text-gray-700{% endif %}">
          {{ postulacion.match_label }}
        </span>
        {% endif %}
      </div>
      <p class="text-xs text-gray-500 mt-1">
        Postulado el {{ postulacion.fecha_postulacion|date:"d/m/Y H:i" }} · Exp: {{ perfil.anios_experiencia|default:"N/A" }} años
      </p>
      {% if postulacion.matched_skills %}
      <div class="mt-3 flex flex-wrap gap-1">
        {% for s in postulacion.matched_skills %}
        <span class="px-2 py-0.5 text-xs rounded bg-gray-100 text-gray-700">{{ s }}</span>
        {% endfor %}
      </div>
      {% endif %}
      <div class="mt-4 flex flex-wrap gap-2">
        <a href="{% url 'detalle_postulante' vacante.id postulacion.id %}" class="btn-primary btn-sm">Ver detalle</a>
        {% if perfil and perfil.cv %}
        <a href="{{ perfil.cv.url }}" target="_blank" class="btn-secondary btn-sm">Ver CV</a>
        {% endif %}
        {% if postulacion.estado == 'enviado' %}
        <form method="post" action="{% url 'administrar_vacante' vacante.id %}">
          {% csrf_token %}
          <input type="hidden" name="postulacion_id" value="{{ postulacion.id }}" />
          <button type="submit" class="btn-outline btn-sm">Marcar visto</button>
        </form>
        {% endif %}
      </div>
    </div>
  </div>
  {% endwith %}
  {% endfor %}
</div>
{% else %}
<p class="text-gray-500">Aun no hay postulantes para esta vacante.</p>
{% endif %}

<div class="mt-6">
  <a href="{% url 'reclutador_vacantes' %}" class="btn-secondary">Volver</a>
</div>
{% endblock %}
